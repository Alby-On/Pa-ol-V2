<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Materiales</title>
    <style>
        /* Estilos generales */
        body { 
            font-family: Arial, sans-serif; 
            background-color: #f4f4f4; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 100vh; 
            margin: 20px;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
            width: 100%; 
            max-width: 650px; /* Aumentado para la tabla */
        }
        h2 { 
            text-align: center; 
            color: #007bff; 
            margin-bottom: 25px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        /* Estilos de formulario */
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #333;
        }
        select, input[type="text"], input[type="number"], input[type="date"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        select:focus, input:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
            outline: none;
        }
        
        /* Tabla de √çtems */
        .table-container {
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        .items-table th, .items-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .items-table th {
            background-color: #f2f2f2;
            color: #333;
        }
        .items-table input {
            padding: 8px;
            margin-bottom: 0;
            border: 1px solid #ccc;
        }
        .items-table .material-input { width: 98%; }
        .items-table .cantidad-input { width: 90%; text-align: right; }

        /* Bot√≥n de eliminar fila */
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .delete-btn:hover { background-color: #c82333; }
        
        /* Botones de acci√≥n */
        #btnContinuar, #btnAddItem {
            width: 100%;
            padding: 15px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
            margin-bottom: 15px;
        }
        #btnContinuar {
            background-color: #28a745; /* Verde para continuar */
        }
        #btnContinuar:hover { 
            background-color: #1e7e34; 
        }

        #btnAddItem {
            background-color: #007bff; /* Azul para agregar √≠tem */
            font-size: 16px;
            padding: 10px;
            margin-top: 5px;
        }
        #btnAddItem:hover {
            background-color: #0056b3;
        }

        #btnEnviarSolicitud {
            width: 100%;
            padding: 15px;
            background-color: #28a745; /* Verde para enviar */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 15px;
        }
        #btnEnviarSolicitud:hover {
            background-color: #1e7e34;
        }

        #btnVolver {
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 15px;
            color: #6c757d;
            text-decoration: none;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #f8f9fa;
        }
        #btnVolver:hover {
            background-color: #e2e6ea;
        }
        
        /* Estilos de error */
        .input-error {
            border: 2px solid red !important;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìù Nueva Solicitud de Materiales</h2>

    <form id="solicitudForm" onsubmit="return false;"> <!-- Prevent default form submission -->
        
        <!-- PASO 1: Selecci√≥n del Docente y Asignatura -->
        <div id="paso-docente">
            <label for="docente">Selecciona el Docente a cargo:</label>
            <select id="docente" name="Docente" required>
                <!-- Opciones de docente actualizadas -->
                <option value="" disabled selected>-- Elija un Docente --</option>
                <option value="AAR√ìN EDUARDO SEP√öLVEDA MEDINA">AAR√ìN EDUARDO SEP√öLVEDA MEDINA</option>
                <option value="ALEJANDRO GABRIEL MOENA VALDERRAMA">ALEJANDRO GABRIEL MOENA VALDERRAMA</option>
                <option value="BRAYAN PATRICIO DEL VALLE AEDO">BRAYAN PATRICIO DEL VALLE AEDO</option>
                <option value="DANIELA FERNANDA MART√çNEZ MART√çNEZ">DANIELA FERNANDA MART√çNEZ MART√çNEZ</option>
                <option value="EDUARDO ARTURO BAST√çAS GARC√çA">EDUARDO ARTURO BAST√çAS GARC√çA</option>
                <option value="EL√çAS ANDR√âS POBLETE AVILA">EL√çAS ANDR√âS POBLETE AVILA</option>
                <option value="GERARDO NICOL√ÅS SEP√öLVEDA GUTI√âRREZ">GERARDO NICOL√ÅS SEP√öLVEDA GUTI√âRREZ</option>
                <option value="GIOVANNI ANDR√âS JARA TORRES">GIOVANNI ANDR√âS JARA TORRES</option>
                <option value="JORGE ANDR√âS P√âREZ MILLAR">JORGE ANDR√âS P√âREZ MILLAR</option>
                <option value="JOSEFA CATALINA LISBOA RIVERA">JOSEFA CATALINA LISBOA RIVERA</option>
                <option value="JULIO CESAR ALARCON MONTEROS">JULIO CESAR ALARCON MONTEROS</option>
                <option value="MANUEL ALEJANDRO HENRIQUEZ OLIVA">MANUEL ALEJANDRO HENRIQUEZ OLIVA</option>
                <option value="MARCO ANTONIO ARRIAGADA CASAS">MARCO ANTONIO ARRIAGADA CASAS</option>
                <option value="PEDRO PATRICIO PEDRERO P√âREZ">PEDRO PATRICIO PEDRERO P√âREZ</option>
                <option value="RICHARD ANTONIO VALDERRAMA SAN MARTIN">RICHARD ANTONIO VALDERRAMA SAN MARTIN</option>
                <option value="RICHARD NICOL√ÅS SANTOS MART√çNEZ">RICHARD NICOL√ÅS SANTOS MART√çNEZ</option>
                <option value="ROBERTO SEBASTIAN CID LIZAMA">ROBERTO SEBASTIAN CID LIZAMA</option>
                <option value="RODRIGO ALEJANDRO CONTRERAS Z√ö√ëIGA">RODRIGO ALEJANDRO CONTRERAS Z√ö√ëIGA</option>
                <option value="RODRIGO ALEJANDRO GARRIDO GARRIDO">RODRIGO ALEJANDRO GARRIDO GARRIDO</option>
                <option value="ROLANDO EDUARDO ORTEGA FUENTES">ROLANDO EDUARDO ORTEGA FUENTES</option>
                <option value="V√çCTOR EDUARDO ZAPATA MYRIK">V√çCTOR EDUARDO ZAPATA MYRIK</option>
                <option value="OTROS DOCENTES">OTROS DOCENTES</option>
            </select>

            <!-- Campo para la Asignatura -->
            <label for="asignatura">Asignatura (M√≥dulo) de Solicitud:</label>
            <input type="text" id="asignatura" name="Asignatura" placeholder="Ej: Electr√≥nica Industrial" required>
            
            <button type="button" id="btnContinuar" onclick="validarDocente()">
                Continuar a Solicitud de √çtems
            </button>
        </div>

        <!-- PASO 2: Formulario de √çtems (Inicialmente oculto) -->
        <div id="paso-items" style="margin-top: 30px;" class="hidden">
            <h3>üõí Detalle de Materiales</h3>
            <div class="table-container">
                <table class="items-table">
                    <thead>
                        <tr>
                            <th style="width: 70%;">Material/√çtem</th>
                            <th style="width: 20%;">Cantidad</th>
                            <th style="width: 10%;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="itemsBody">
                        <!-- Filas de √≠tems se agregan aqu√≠ con JS -->
                    </tbody>
                </table>
            </div>
            
            <button type="button" id="btnAddItem" onclick="agregarFilaMaterial()">
                + Agregar otro Material
            </button>

            <!-- Bot√≥n para enviar la solicitud final -->
            <button type="button" id="btnEnviarSolicitud" onclick="enviarSolicitud()">
                Enviar Solicitud Final
            </button>
        </div>

    </form>
    
    <a href="menu.html" id="btnVolver">‚Üê Volver al Men√∫ Principal</a>
</div>

<script>
    // Docentes v√°lidos actualizados para la validaci√≥n
    const docentesValidos = [
        "AAR√ìN EDUARDO SEP√öLVEDA MEDINA",
        "ALEJANDRO GABRIEL MOENA VALDERRAMA",
        "BRAYAN PATRICIO DEL VALLE AEDO",
        "DANIELA FERNANDA MART√çNEZ MART√çNEZ",
        "EDUARDO ARTURO BAST√çAS GARC√çA",
        "EL√çAS ANDR√âS POBLETE AVILA",
        "GERARDO NICOL√ÅS SEP√öLVEDA GUTI√âRREZ",
        "GIOVANNI ANDR√âS JARA TORRES",
        "JORGE ANDR√âS P√âREZ MILLAR",
        "JOSEFA CATALINA LISBOA RIVERA",
        "JULIO CESAR ALARCON MONTEROS",
        "MANUEL ALEJANDRO HENRIQUEZ OLIVA",
        "MARCO ANTONIO ARRIAGADA CASAS",
        "PEDRO PATRICIO PEDRERO P√âREZ",
        "RICHARD ANTONIO VALDERRAMA SAN MARTIN",
        "RICHARD NICOL√ÅS SANTOS MART√çNEZ",
        "ROBERTO SEBASTIAN CID LIZAMA",
        "RODRIGO ALEJANDRO CONTRERAS Z√ö√ëIGA",
        "RODRIGO ALEJANDRO GARRIDO GARRIDO",
        "ROLANDO EDUARDO ORTEGA FUENTES",
        "V√çCTOR EDUARDO ZAPATA MYRIK",
        "OTROS DOCENTES"
    ];

    /**
     * Valida que el docente y la asignatura est√©n seleccionados/rellenados.
     * Si es v√°lido, avanza al paso de agregar materiales.
     */
    function validarDocente() {
        const selectDocente = document.getElementById('docente');
        const inputAsignatura = document.getElementById('asignatura');
        const docenteSeleccionado = selectDocente.value;
        const asignaturaValue = inputAsignatura.value.trim();
        let isValid = true;
        
        // Limpiar cualquier clase de error previa
        selectDocente.classList.remove('input-error');
        inputAsignatura.classList.remove('input-error');

        // 1. Validar Docente
        if (!docenteSeleccionado || !docentesValidos.includes(docenteSeleccionado)) {
            alert('Por favor, selecciona un docente v√°lido de la lista.');
            selectDocente.classList.add('input-error');
            isValid = false;
        }

        // 2. Validar Asignatura
        if (asignaturaValue === '') {
            alert('Por favor, ingresa el nombre de la Asignatura/M√≥dulo.');
            inputAsignatura.classList.add('input-error');
            isValid = false;
        }

        if (!isValid) {
            return;
        }

        // 3. Si la selecci√≥n es v√°lida, avanzar
        // alert('Docente y Asignatura v√°lidos. ¬°Ahora puedes a√±adir los materiales!');

        // Ocultar el selector de docente/asignatura
        document.getElementById('paso-docente').classList.add('hidden');

        // Mostrar el formulario de √≠tems y agregar una fila inicial si est√° vac√≠a
        document.getElementById('paso-items').classList.remove('hidden');
        if (document.getElementById('itemsBody').children.length === 0) {
            agregarFilaMaterial();
        }
    }

    /**
     * Agrega una nueva fila a la tabla para ingresar un material y cantidad.
     */
    function agregarFilaMaterial() {
        const tbody = document.getElementById('itemsBody');
        const nuevaFila = tbody.insertRow();
        
        // Columna 1: Material/√çtem
        let cell1 = nuevaFila.insertCell(0);
        cell1.innerHTML = `<input type="text" class="material-input" placeholder="Nombre del material o herramienta" required>`;
        
        // Columna 2: Cantidad
        let cell2 = nuevaFila.insertCell(1);
        cell2.innerHTML = `<input type="number" class="cantidad-input" value="1" min="1" required>`;
        
        // Columna 3: Acci√≥n (Eliminar)
        let cell3 = nuevaFila.insertCell(2);
        cell3.innerHTML = `<button type="button" class="delete-btn" onclick="eliminarFila(this)">X</button>`;
    }

    /**
     * Elimina la fila de la tabla a la que pertenece el bot√≥n pulsado.
     */
    function eliminarFila(btn) {
        const fila = btn.parentNode.parentNode;
        const tbody = document.getElementById('itemsBody');
        
        if (tbody.children.length > 1) {
            tbody.removeChild(fila);
        } else {
            // No permitir eliminar la √∫ltima fila para que la solicitud no quede vac√≠a
            alert("Debe haber al menos un material en la solicitud.");
        }
    }

    /**
     * Recolecta todos los datos del formulario (Docente, Asignatura e √çtems) 
     * y simula el env√≠o.
     */
    function enviarSolicitud() {
        const docente = document.getElementById('docente').value;
        const asignatura = document.getElementById('asignatura').value.trim();
        const itemsBody = document.getElementById('itemsBody');
        const items = [];
        let hayError = false;

        // 1. Validar que la tabla no est√© vac√≠a
        if (itemsBody.children.length === 0) {
            alert('Debes agregar al menos un material a la solicitud.');
            return;
        }

        // 2. Recolectar y validar datos de cada fila
        Array.from(itemsBody.children).forEach((row, index) => {
            const materialInput = row.cells[0].querySelector('input');
            const cantidadInput = row.cells[1].querySelector('input');

            materialInput.classList.remove('input-error');
            cantidadInput.classList.remove('input-error');

            const material = materialInput.value.trim();
            const cantidad = parseInt(cantidadInput.value, 10);

            if (material === '') {
                materialInput.classList.add('input-error');
                hayError = true;
            }
            if (isNaN(cantidad) || cantidad < 1) {
                cantidadInput.classList.add('input-error');
                hayError = true;
            }

            items.push({ material, cantidad });
        });

        if (hayError) {
            alert('Por favor, completa todos los campos de material y aseg√∫rate de que la cantidad sea v√°lida (mayor a cero).');
            return;
        }

        // 3. Simulaci√≥n de env√≠o de datos
        console.log("--- Datos de la Solicitud ---");
        console.log("Docente:", docente);
        console.log("Asignatura:", asignatura);
        console.log("Materiales:", items);

        let mensajeItems = items.map(item => `  - ${item.material} (x${item.cantidad})`).join('\n');

        // Mostrar un resumen de lo que se enviar√≠a (eventualmente a Google Sheets)
        alert(`Solicitud Lista para Enviar:\n\n` +
              `Docente: ${docente}\n` +
              `Asignatura: ${asignatura}\n\n` +
              `Materiales:\n${mensajeItems}\n\n` +
              `[FALTA CONEXI√ìN REAL A GOOGLE APPS SCRIPT]`
        );

        // Aqu√≠ ir√≠a el fetch() a Google Apps Script para registrar la solicitud.
    }

    // Inicializar con una fila vac√≠a cuando se pase al paso 2
    window.onload = function() {
        // Inicializar la primera fila despu√©s de que el DOM est√© cargado
        // Esto se realiza ahora en validarDocente()
    };
</script>

</body>
</html>

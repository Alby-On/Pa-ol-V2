<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti贸n de Materiales - Acceso Docentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }
        .view {
            display: none; /* Oculta todas las vistas por defecto */
        }
        .view.active {
            display: block; /* Muestra solo la vista activa */
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="email"], input[type="password"], input[type="tel"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Asegura que el padding no cambie el ancho */
        }
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-primary {
            background-color: #007bff; /* Azul */
        }
        .btn-secondary {
            background-color: #6c757d; /* Gris */
        }
        .btn-primary:hover, .btn-secondary:hover {
            opacity: 0.9;
        }
        .welcome-buttons button {
            margin-bottom: 10px;
        }
        .error-message {
            color: red;
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="welcome-view" class="view active">
        <h2> Bienvenido al Gestor de Materiales</h2>
        <p style="text-align: center; margin-bottom: 30px;">Por favor, inicia sesi贸n para solicitar materiales o reg铆strate si es tu primera vez.</p>
        <div class="welcome-buttons">
            <button class="btn-primary" onclick="showView('login-view')"> Iniciar Sesi贸n</button>
            <button class="btn-secondary" onclick="showView('register-view')">锔 Registrarse</button>
        </div>
    </div>

    <div id="register-view" class="view">
        <h2>锔 Registro de Docentes</h2>
        <form id="register-form">
            
            <label for="nombreCompleto">Nombre Completo</label>
            <input type="text" id="nombreCompleto" name="Nombre Completo" required>

            <label for="rut">RUT (sin puntos, con guion)</label>
            <input type="text" id="rut" name="Rut" required>
            
            <label for="carrera">Carrera</label>
            <select id="carrera" name="Carrera" required>
                <option value="" disabled selected>Selecciona tu carrera</option>
                <option value="Ingenier铆a El茅ctrica">Ingenier铆a El茅ctrica</option>
                <option value="T茅cnico de nivel superior en Electricidad Industrial">T茅cnico de nivel superior en Electricidad Industrial</option>
                <option value="Ingenier铆a en Automatizaci贸n y Rob贸tica">Ingenier铆a en Automatizaci贸n y Rob贸tica</option>
                <option value="T茅cnico de nivel superior en Automatizaci贸n y Rob贸tica">T茅cnico de nivel superior en Automatizaci贸n y Rob贸tica</option>
                <option value="Ingenier铆a en Mecatr贸nica">Ingenier铆a en Mecatr贸nica</option>
                <option value="T茅cnico de nivel superior en Mecatr贸nica">T茅cnico de nivel superior en Mecatr贸nica</option>
                <option value="rea Mec谩nica">rea Mec谩nica</option>
                <option value="Otras reas">Otras reas</option>
            </select>

            <label for="telefono">Tel茅fono</label>
            <input type="tel" id="telefono" name="Telefono" required>

            <label for="email">Email</label>
            <input type="email" id="email-reg" name="Email" required>

            <label for="password-reg">Contrase帽a</label>
            <input type="password" id="password-reg" name="Contrase帽a" required>

            <div class="error-message" id="register-error"></div>
            
            <button type="submit" class="btn-primary">Registrarse</button>
            <button type="button" class="btn-secondary" onclick="showView('welcome-view')">Volver</button>
        </form>
    </div>

    <div id="login-view" class="view">
        <h2> Inicio de Sesi贸n</h2>
        <form id="login-form">
            <label for="email-log">Email</label>
            <input type="email" id="email-log" name="Email" required>

            <label for="password-log">Contrase帽a</label>
            <input type="password" id="password-log" name="Contrase帽a" required>

            <div class="error-message" id="login-error"></div>

            <button type="submit" class="btn-primary">Iniciar Sesi贸n</button>
            <button type="button" class="btn-secondary" onclick="showView('welcome-view')">Volver</button>
        </form>
    </div>

    <div id="dashboard-view" class="view">
        <h2 id="welcome-user">Hola, Docente!</h2>
        <p>Desde aqu铆 podr谩s solicitar materiales y ver tu historial de solicitudes.</p>
        <button class="btn-primary" onclick="showView('request-view')"> Solicitar Materiales</button>
        <button class="btn-secondary" onclick="showView('history-view')"> Ver Historial</button>
        <hr style="margin-top: 20px;">
        <button class="btn-secondary" onclick="logout()"> Cerrar Sesi贸n</button>
    </div>

</div>

<script>
    // URL de tu Web App de Google Apps Script (隆Debes reemplazarla!)
    const WEB_APP_URL = 'REEMPLAZA_ESTA_URL_CON_TU_ENDPOINT_DE_APPS_SCRIPT';
    
    // Funci贸n para cambiar de vista
    function showView(viewId) {
        // Oculta todas las vistas
        document.querySelectorAll('.view').forEach(view => {
            view.classList.remove('active');
        });
        // Muestra la vista solicitada
        document.getElementById(viewId).classList.add('active');
    }

    // Manejar el env铆o del formulario de REGISTRO
    document.getElementById('register-form').addEventListener('submit', function(e) {
        e.preventDefault(); // Detiene el env铆o del formulario tradicional
        
        const form = e.target;
        const data = {
            action: 'registro', // La acci贸n que espera tu Apps Script
            payload: {
                nombreCompleto: form['nombreCompleto'].value,
                rut: form['rut'].value,
                carrera: form['carrera'].value,
                telefono: form['telefono'].value,
                email: form['email-reg'].value,
                password: form['password-reg'].value
            }
        };

        // LLAMADA A LA API (Apps Script)
        fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // Necesario para la conexi贸n inicial con Apps Script
            contentType: 'application/json',
            body: JSON.stringify(data)
        })
        .then(response => {
            // Nota: Con 'no-cors', el .json() o .text() fallar谩. 
            // Debes cambiar 'no-cors' por 'cors' y ajustar la respuesta 
            // en Apps Script para un entorno real. Por ahora, asumimos 茅xito.
            document.getElementById('register-error').textContent = 'Registro enviado. Por favor, inicia sesi贸n.';
            form.reset();
            setTimeout(() => showView('login-view'), 2000);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('register-error').textContent = 'Error al intentar registrar. Intente nuevamente.';
        });
    });

    // Manejar el env铆o del formulario de INICIO DE SESIN
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = e.target;
        const data = {
            action: 'login',
            payload: {
                email: form['email-log'].value,
                password: form['password-log'].value
            }
        };

        // LLAMADA A LA API (Apps Script)
        fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // Mismo problema de CORS que en el registro
            contentType: 'application/json',
            body: JSON.stringify(data)
        })
        .then(response => {
            // En un caso real, aqu铆 procesar铆as la respuesta JSON de tu Apps Script.
            // Si el login es exitoso:
            const docenteName = form['email-log'].value.split('@')[0]; // Simulaci贸n
            document.getElementById('welcome-user').textContent = ' Hola, ' + docenteName + '!';
            
            // Guardar el email del usuario en el navegador para futuras solicitudes
            localStorage.setItem('docenteEmail', form['email-log'].value); 
            
            form.reset();
            showView('dashboard-view');
        })
        .catch(error => {
            // Esto se ejecutar铆a si la petici贸n falla completamente (no si el login es malo)
            console.error('Error:', error);
            document.getElementById('login-error').textContent = 'Error de conexi贸n. Verifica la URL de la API.';
        });

        // NOTA: Para simular un error de login sin la API
        // document.getElementById('login-error').textContent = 'Email o contrase帽a incorrectos.';
    });

    // Funci贸n para cerrar sesi贸n
    function logout() {
        localStorage.removeItem('docenteEmail');
        showView('welcome-view');
    }

    // Asegurarse de que al cargar, se vea la vista de bienvenida
    document.addEventListener('DOMContentLoaded', () => {
        showView('welcome-view');
    });

</script>

</body>
</html>
